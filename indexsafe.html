<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>One-Time Artwork</title>
<style>
body { text-align:center; background:#f5f5f5; font-family:Arial; }
canvas { background:#fff; margin-top:20px; }
button { padding:12px 22px; font-size:16px; }
</style>
</head>
<body>

<h2>Your One-Time Artwork</h2>
<button id="btn">Generate</button>
<br>
<canvas id="canvas" width="600" height="600"></canvas>
<br>
<button id="download" style="display:none">Download PNG</button>

<script>
const params = new URLSearchParams(location.search);
const token = params.get("token");

document.getElementById("btn").onclick = async () => {
  const res = await fetch(
    "https://YOUR-WORKER-URL/?token=" + token
  );

  if (!res.ok) {
    document.body.innerHTML = "<h3>Access Expired</h3>";
    return;
  }

  generateArt();
  document.getElementById("btn").disabled = true;
  document.getElementById("download").style.display = "inline-block";
};

function generateArt() {
  const c = document.getElementById("canvas");
  const ctx = c.getContext("2d");

  ctx.clearRect(0,0,600,600);
  ctx.strokeStyle = "#000";

  for (let i = 0; i < 70; i++) {
    let a = Math.random()*0.02 - 0.01;
    let b = Math.random()*4 - 2;
    let c0 = Math.random()*300;

    ctx.beginPath();
    for (let x = -300; x < 300; x++) {
      let y = a*x*x + b*x + c0;
      ctx.lineTo(x+300, 600-y);
    }
    ctx.stroke();
  }
}

document.getElementById("download").onclick = () => {
  const link = document.createElement("a");
  link.download = "SCISunny-Art.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
};
</script>

</body>
</html>
